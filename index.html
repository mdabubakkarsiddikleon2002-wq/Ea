<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Monetag Mini App – Earn</title>
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2b;
      --muted: #9fb0c9;
      --text: #e7f0ff;
      --primary: #0ea5e9; /* sky-500 */
      --primary-600: #0284c7;
      --accent: #22d3ee; /* cyan-400 */
      --danger: #ef4444;
      --success: #22c55e;
      --shadow: 0 10px 30px rgba(2,132,199,.25);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 50% -10%, #0b2550 0%, #0b1220 60%);
      color: var(--text);
    }
    .app { display: grid; grid-template-rows: auto 1fr auto; height: 100dvh; }

    /* Header */
    .header {
      position: sticky; top: 0; z-index: 5;
      padding: 14px 16px 8px; backdrop-filter: saturate(140%) blur(8px);
      background: linear-gradient(180deg, rgba(2,12,26,.85), rgba(2,12,26,.35) 70%, transparent);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .row { display: flex; align-items: center; gap: 12px; }
    .grow { flex: 1; }
    .user-chip {
      display: inline-flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 999px;
      background: linear-gradient(90deg, rgba(14,165,233,.18), rgba(34,211,238,.10));
      border: 1px solid rgba(14,165,233,.35);
      box-shadow: var(--shadow);
    }
    .avatar { width: 36px; height: 36px; border-radius: 999px; background: #0b1d3a; display: grid; place-items: center; font-weight: 700; }

    /* Cards */
    .container { padding: 14px 14px 92px; }
    .grid { display: grid; gap: 12px; }
    .card {
      background: linear-gradient(180deg, rgba(17,26,43,.9), rgba(10,16,28,.92));
      border: 1px solid rgba(148,163,184,.15);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .card h3 { margin: 0 0 8px; font-size: 16px; font-weight: 700; letter-spacing: .2px; }
    .muted { color: var(--muted); font-size: 13px; }

    .balance {
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 8px;
      background: radial-gradient(500px 200px at 20% -40%, rgba(2,132,199,.3), transparent 60%),
                  radial-gradient(400px 160px at 120% -60%, rgba(34,211,238,.25), transparent 60%),
                  linear-gradient(180deg, rgba(2,8,23,.7), rgba(2,8,23,.95));
      border: 1px solid rgba(56,189,248,.35);
    }
    .balance .amount { font-size: 28px; font-weight: 800; letter-spacing: .5px; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.12); }

    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 100%; height: 56px; border-radius: 14px;
      border: 1px solid rgba(14,165,233,.5); background: linear-gradient(180deg, var(--primary), var(--primary-600));
      color: white; font-weight: 700; letter-spacing: .2px; cursor: pointer;
      box-shadow: 0 8px 18px rgba(14,165,233,.35);
      transition: transform .05s ease, filter .2s ease; user-select: none;
    }
    .btn:active { transform: translateY(1px) scale(.995); }
    .btn[disabled] { opacity: .6; filter: saturate(.4); pointer-events: none; }

    .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    .list { display: grid; gap: 10px; }
    .item { padding: 12px; border-radius: 12px; border: 1px solid rgba(148,163,184,.15); background: #0d1628; display: grid; gap: 4px; }

    .form { display: grid; gap: 10px; }
    .field { display: grid; gap: 6px; }
    .input, .select, .textarea {
      height: 46px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(148,163,184,.25);
      outline: none; background: #0b1426; color: var(--text); font-size: 15px;
    }
    .textarea { height: 90px; resize: vertical; }
    .help { font-size: 12px; color: var(--muted); }
    .danger { color: var(--danger); }
    .success { color: var(--success); }

    /* Tabs */
    .tabs { position: fixed; left: 0; right: 0; bottom: 0; backdrop-filter: blur(10px) saturate(140%);
      background: linear-gradient(180deg, rgba(3,7,18,.2), rgba(3,7,18,.75)); border-top: 1px solid rgba(255,255,255,.08);
      display: grid; grid-template-columns: repeat(5, 1fr); padding: 8px 6px; gap: 6px; z-index: 5; }
    .tab { display: grid; place-items: center; gap: 4px; padding: 8px 6px; border-radius: 12px; color: var(--muted); font-size: 11.5px; }
    .tab.active { color: var(--text); background: rgba(14,165,233,.12); border: 1px solid rgba(14,165,233,.35); }

    .hidden { display: none !important; }
    .copy { cursor: pointer; }
    .tag { font-size: 12px; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(148,163,184,.2); }
    .kpi { display:grid; grid-template-columns: repeat(4,1fr); gap: 10px; }
    .kbox { background:#0d1628; border:1px solid rgba(148,163,184,.15); border-radius:12px; padding:10px; }
    .kbox .v { font-size:16px; font-weight:800 }
    .kbox .l { font-size:12px; color:var(--muted) }

    a { color: var(--accent); text-decoration: none; }
  </style>
  
  <!-- Telegram Mini App JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Monetag SDK (replace zone if needed) -->
  <script src='//libtl.com/sdk.js' data-zone='9732839' data-sdk='show_9732839'></script>
</head>
<body>
<div class="app">
  <!-- Header -->
  <header class="header">
    <div class="row">
      <div class="user-chip">
        <div class="avatar" id="avatar">👤</div>
        <div>
          <div id="uname" style="font-weight:700">User</div>
          <div class="muted" id="uid">UID: -</div>
        </div>
      </div>
      <div class="grow"></div>
      <span class="tag" id="vipTag">VIP: Free</span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- HOME TAB -->
    <section id="tab-home" class="grid">
      <div class="card balance">
        <div>
          <div class="muted">Current balance</div>
          <div class="amount" id="balance">₦0</div>
          <div class="muted" id="lastAction">Last update</div>
        </div>
        <div>
          <span class="pill">Minimum Withdrawal: ₦1000</span>
        </div>
      </div>

      <div class="grid">
        <div class="row-2">
          <button class="btn" id="adBtn1">🎯 Ad Task 1</button>
          <button class="btn" id="adBtn2">🚀 Ad Task 2</button>
        </div>
        <button class="btn" id="adBtn3">💎 Ad Task 3</button>
        <div class="help">👉<b>₦1</b> will be automatically added after watching each ad. Repeated spamming will cause a cooldown. </div>
      </div>

      <div class="grid">
        <div class="kpi">
          <div class="kbox"><div class="v" id="kEarn">₦0</div><div class="l">Total income</div></div>
          <div class="kbox"><div class="v" id="kTasks">0</div><div class="l">Complete</div></div>
          <div class="kbox"><div class="v" id="kRef">0</div><div class="l">Refer </div></div>
          <div class="kbox"><div class="v" id="kWith">₦0</div><div class="l">Total withdrawal</div></div>
        </div>
      </div>

      <div class="card">
        <h3>How to work?</h3>
        <div class="list">
          <div class="item">• Click on the task button to view the ad. </div>
          <div class="item">• You will get<b>₦1</b>for each valid view</div>
          <div class="item">• You can withdraw if you have 1000 taka.</div>
        </div>
      </div>
    </section>

    <!-- TASK TAB -->
    <section id="tab-task" class="grid hidden">
      <div class="card">
        <h3>Daily Tasks </h3>
        <div class="grid">
          <button class="btn" id="tAd1">🎯 Watch Ad & Earn</button>
          <button class="btn" id="tAd2">🚀 Watch Ad & Earn</button>
          <button class="btn" id="tAd3">💎 Watch Ad & Earn</button>
          <div class="help">Regular use may cause a cooldown (0 seconds).</div>
        </div>
      </div>

      <div class="card">
        <h3>Tasks History</h3>
        <div id="taskHistory" class="list"></div>
      </div>
    </section>

    <!-- TEAM TAB -->
    <section id="tab-team" class="grid hidden">
      <div class="card">
        <h3>Invite & Earn</h3>
        <div class="list">
          <div class="item">
            <div class="muted">Your referral link</div>
            <div class="row" style="justify-content:space-between; gap:8px; align-items:center;">
              <div id="refLink" class="muted" style="word-break:break-all"></div>
              <button class="btn" id="copyRef" style="width:auto; padding:0 14px; height:40px">📋 Copy</button>
            </div>
          </div>
          <div class="item"><b id="refCount">0</b> John referred users</div>
          <div class="item">Every valid referral = <b>₦0</b> bonus</div>
        </div>
      </div>
    </section>

    <!-- WITHDRAW TAB -->
    <section id="tab-withdraw" class="grid hidden">
      <div class="card balance">
        <div>
          <div class="muted">Available for withdrawal</div>
          <div class="amount" id="wBalance">₦ 0</div>
        </div>
        <div><span class="pill">Minimum: ₦1000</span></div>
      </div>

      <div class="card">
        <h3>Withdrawal form</h3>
        <form class="form" id="withdrawForm">
          <div class="field">
            <label>Name</label>
            <input class="input" id="wName" placeholder="আপনার নাম" required />
          </div>
          <div class="field">
            <label>Wallet address</label>
            <input class="input" id="wMobile" placeholder="Enter Wallet address" required />
          </div>
          <div class="field">
            <label>Payment system</label>
            <select class="select" id="wMethod" required>
              <option value="">Select</option>
              <option>OPAY</option>
              <option>PALMPAY</option>
              <option>KUDA</option>
              <option>MONIY POINT </option>
            </select>
          </div>
          <div class="field">
            <label>Amount</label>
            <input type="number" min="1000" class="input" id="wAmount" placeholder="₦1000+" required />
            <div class="help">Minimum ₦1000. Do not request more than the balance.</div>
          </div>
          <button class="btn" type="submit" id="wSubmit">💸 Withdraw Request</button>
          <div id="wMsg" class="help"></div>
        </form>
      </div>

      <div class="card">
        <h3>Withdrawal history</h3>
        <div id="withHistory" class="list"></div>
      </div>
    </section>

    <!-- PROFILE TAB -->
    <section id="tab-profile" class="grid hidden">
      <div class="card">
        <h3>Profile</h3>
        <div class="list">
          <div class="item"><b>Name:</b> <span id="pName">-</span></div>
          <div class="item"><b>User:</b> <span id="pUser">-</span></div>
          <div class="item"><b>UID:</b> <span id="pUid">-</span></div>
          <div class="item"><b>Balance:</b> <span id="pBal">₦0</span></div>
          <div class="item">
            <div class="muted">Note: This is our trusted free income Telegram bot, here you will get 100% withdrawal payment by working.</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Tabs -->
  <nav class="tabs">
    <div class="tab active" data-tab="home">🏠<div>Home </div></div>
    <div class="tab" data-tab="task">🧩<div>Tasks </div></div>
    <div class="tab" data-tab="team">👥<div>Team</div></div>
    <div class="tab" data-tab="withdraw">💳<div>Withdraw</div></div>
    <div class="tab" data-tab="profile">👤<div>Profile</div></div>
  </nav>
</div>

<script>
  // ====== CONFIG (Replace with your details) ======
  const BOT_TOKEN = '8322375043:AAEnXPNxuLeOoF-fg3QkcfHizg94jeYtphI; // ⚠️ Exposed in client – for demo only
  const PRIVATE_CHANNEL_ID = -1002699265904; // your private channel ID
  const BOT_USERNAME = '@Earning_25_bot'; // for referral link
  const REWARD_PER_AD = 1; // ₦1 per valid ad view (demo)
  const COOLDOWN_MS = 20000; // 20 seconds per button
  const MIN_WITHDRAW = 1000;

  // ====== Telegram WebApp context ======
  const tg = window.Telegram?.WebApp;
  if (tg) { try { tg.expand(); } catch(e){} }
  const init = tg?.initDataUnsafe || {};
  const me = init.user || {};
  const UID = me.id || 'guest';
  const UNAME = me.username ? '@' + me.username : (me.first_name || 'Guest');
  const FULLNAME = [me.first_name, me.last_name].filter(Boolean).join(' ') || 'Guest';

  // ====== Storage helpers (per user) ======
  const k = (name) => `${name}_${UID}`;
  const get = (name, fallback) => {
    const raw = localStorage.getItem(k(name));
    try { return raw ? JSON.parse(raw) : fallback; } catch { return fallback; }
  };
  const set = (name, val) => localStorage.setItem(k(name), JSON.stringify(val));

  // ====== State ======
  let balance = get('balance', 0);
  let tasks = get('tasks', []); // {ts,label,amount}
  let withdraws = get('withdraws', []); // {ts,amount,method,mobile,status}
  let refs = get('refs', {count: 0});
  let totals = get('totals', {earn: 0, with: 0});
  let cooldown = get('cooldown', { }); // per-button last time

  // ====== UI Elements ======
  const $ = (q) => document.querySelector(q);
  const $$ = (q) => Array.from(document.querySelectorAll(q));

  function fmt(amount) { return `₦${Number(amount||0)}`; }
  function nowFmt(){ return new Date().toLocaleString(); }

  function renderAll(){
    // header
    $('#uname').textContent = FULLNAME || 'User';
    $('#uid').textContent = `UID: ${UID}`;
    $('#avatar').textContent = (FULLNAME||'U').charAt(0).toUpperCase();

    // balances
    $('#balance').textContent = fmt(balance);
    $('#wBalance').textContent = fmt(balance);
    $('#pBal').textContent = fmt(balance);
    $('#kEarn').textContent = fmt(totals.earn);
    $('#kWith').textContent = fmt(totals.with);
    $('#kTasks').textContent = tasks.length;
    $('#kRef').textContent = refs.count;
    $('#lastAction').textContent = `update ${nowFmt()}`;

    // profile
    $('#pName').textContent = FULLNAME;
    $('#pUser').textContent = UNAME;
    $('#pUid').textContent = UID;

    // histories
    const tWrap = $('#taskHistory');
    tWrap.innerHTML = tasks.slice().reverse().map(t => `<div class="item">🧩 <b>${t.label}</b> — ${fmt(t.amount)} <span class="muted" style="float:right">${new Date(t.ts).toLocaleString()}</span></div>`).join('') || '<div class="muted">No Tasks </div>';

    const wWrap = $('#withHistory');
    wWrap.innerHTML = withdraws.slice().reverse().map(w => `<div class="item">💳 ${fmt(w.amount)} → <b>${w.method}</b> (${w.mobile}) <span class="tag" style="margin-left:8px">${w.status}</span> <span class="muted" style="float:right">${new Date(w.ts).toLocaleString()}</span></div>`).join('') || '<div class="muted">No withdraw history</div>';

    // withdraw form defaults
    $('#wName').value = FULLNAME;
    $('#wAmount').value = Math.min(balance, Math.max(MIN_WITHDRAW, balance));

    // referral link
    const deep = `https://t.me/${BOT_USERNAME}?start=ref_${UID}`;
    $('#refLink').textContent = deep;
    $('#refCount').textContent = refs.count;
  }

  // ====== Tabs ======
  $$('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      $$('.tab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      const to = tab.getAttribute('data-tab');
      ['home','task','team','withdraw','profile'].forEach(id => {
        document.getElementById(`tab-${id}`).classList.toggle('hidden', id!==to);
      })
      renderAll();
    })
  })

  // ====== Reward Logic ======
  async function showAdAndReward(label){
    // per-button cooldown
    const key = `btn_${label}`;
    const last = cooldown[key] || 0;
    const diff = Date.now() - last;
    if (diff < COOLDOWN_MS) {
      const left = Math.ceil((COOLDOWN_MS - diff)/1000);
      toast(`⏱️ অনুগ্রহ করে ${left}s পরে আবার চেষ্টা করুন`);
      return;
    }

    try {
      // call Monetag SDK function provided by script tag
      if (typeof show_9732839 === 'function') {
        await show_9732839();
      }
      // demo reward
      balance += REWARD_PER_AD;
      totals.earn += REWARD_PER_AD;
      tasks.push({ ts: Date.now(), label, amount: REWARD_PER_AD });
      cooldown[key] = Date.now();
      persist();
      renderAll();
      toast(`✅ Ad viewed! +${fmt(REWARD_PER_AD)} যোগ হয়েছে`);
    } catch (e) {
      console.error('Ad error', e);
      toast('⚠️ Failed, try again later.');
    }
  }

  function persist(){
    set('balance', balance);
    set('tasks', tasks);
    set('withdraws', withdraws);
    set('refs', refs);
    set('totals', totals);
    set('cooldown', cooldown);
  }

  // Buttons wire-up (Home + Task)
  [['#adBtn1','Task 1'],['#adBtn2','Task 2'],['#adBtn3','Task 3'],['#tAd1','Daily 1'],['#tAd2','Daily 2'],['#tAd3','Daily 3']]
    .forEach(([sel,label])=> { const el=$(sel); if(el) el.addEventListener('click', ()=>showAdAndReward(label)) });

  // Copy referral
  $('#copyRef').addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText($('#refLink').textContent);
      toast('📋 Copy Successful');
    } catch { toast('কপি সমর্থিত নয়'); }
  });

  // Withdraw submit
  $('#withdrawForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = $('#wName').value.trim();
    const mobile = $('#wMobile').value.trim();
    const method = $('#wMethod').value.trim();
    const amount = parseInt($('#wAmount').value, 10) || 0;
    const msg = $('#wMsg');

    if (amount < MIN_WITHDRAW) { msg.textContent = `Minimum ${fmt(MIN_WITHDRAW)} প্রয়োজন`; msg.className='help danger'; return; }
    if (amount > balance) { msg.textContent = `You do not have enough balance.`; msg.className='help danger'; return; }

    // Record locally
    const rec = { ts: Date.now(), amount, method, mobile, status: 'Pending' };
    withdraws.push(rec);
    balance -= amount;
    totals.with += amount;
    persist();
    renderAll();

    // Notify to private channel via Bot API (demo; server-side recommended)
    const text = `📥 <b>Withdraw Request</b>%0A👤 Name: ${encodeURIComponent(name)}%0A🆔 UID: ${UID}%0A💳 Method: ${encodeURIComponent(method)}%0A📱 Mobile: ${encodeURIComponent(mobile)}%0A💰 Amount: ${amount}%0A⏰ ${encodeURIComponent(new Date().toLocaleString())}`;
    try {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${PRIVATE_CHANNEL_ID}&parse_mode=HTML&text=${text}`;
      await fetch(url, { method: 'GET' });
      $('#wMsg').textContent = '✅ Successful Submit';
      $('#wMsg').className = 'help success';
    } catch (e) {
      console.warn('Telegram notify failed', e);
      $('#wMsg').textContent = '⚠️ Notification failed, please try again later.';
      $('#wMsg').className = 'help danger';
    }
  });

  // Simple toast
  function toast(t){
    let el = document.getElementById('toast');
    if(!el){ el = document.createElement('div'); el.id='toast'; document.body.appendChild(el);
      Object.assign(el.style,{position:'fixed',left:'50%',bottom:'90px',transform:'translateX(-50%)',background:'rgba(3,7,18,.9)',color:'#e7f0ff',padding:'10px 14px',border:'1px solid rgba(148,163,184,.25)',borderRadius:'12px',zIndex:99,boxShadow:'0 10px 30px rgba(0,0,0,.4)'}); }
    el.textContent = t; el.style.opacity='1';
    clearTimeout(window.__tto); window.__tto=setTimeout(()=>{ el.style.opacity='0'; }, 1600);
  }

  // Handle start_param for referrals (basic demo)
  (function handleStartParam(){
    const sp = init.start_param || '';
    if (sp.startsWith('ref_')){
      const refBy = sp.split('ref_')[1];
      // Only count once per UID
      const flagged = get('referredBy', null);
      if (!flagged) {
        set('referredBy', refBy);
        // Send a simple ping to channel so you can award on admin side if desired
        const text = `👥 <b>New Referral</b>%0A👤 User: ${encodeURIComponent(FULLNAME)} (${UID})%0A🔗 RefBy: ${encodeURIComponent(refBy)}`;
        fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${PRIVATE_CHANNEL_ID}&parse_mode=HTML&text=${text}`);
      }
    }
  })();

  // Init render
  renderAll();
</script>
</body>
</html>